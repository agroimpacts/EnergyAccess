---
title: "Deforestation and Energy Access"
author: "Nara McCray & Daniel Lassila"
date: "12/6/2017"
output:
  slidy_presentation:
    default:
    css: custom.css
    fig_height: 4
    fig_width: 6
  ioslides_presentation: default
subtitle: Exploring the relationship between energy access and deforestation
---

```{r html_doc, eval=FALSE, include=FALSE}
library(rmarkdown)
library(knitr)
render(input = "Nd_Presentation.Rmd", output_format = "html_document", output_file = "ND_Presentation.html")
```


## What is Energy Access?


- basic forms of energy are available in the form of biofuel such as wood and require labor and time inputs to collect
- millions of people around the world, disproportionately the poorest and most vulnerable, rely on forests for subsistence
- Biomass in the form of wood/charcoal is often used as an energy source
- alternative energy sources such as electricity have been shown to reduce deforestation pressure while also improving the quality of life for people living in rural areas of developing countries
- 1.1 billion people are living today without access to electricity

----

## Deforestation and Energy Access


- Overpopulation and ecoomic development are widely known as contributing factors to deforestation
- Because rural communities often rely on forests as an energy source, it is estimated that expanding rural electrification access will wean these populations off the consumption of biomass for their energy needs
- Rural electrification can also be associated with environmental degredation depending on circumstance

----

## Objective


This research project explores the relationship between deforestation and influencing variables
  The main variable of interest being energy access

Recent research has found that not only does rural electrification cause deforestation rates to decrease, but also that it is more robust in explaining deforestation than population growth or development

This research was conducted on the national scale with 158 countries, we intend to do a more indepth analysis on one country: Ghana

----

## Ghana
Rapid increase in Energy Access in Ghana
<center>
![African Energy Access Chart](../Vignettes/fig/CopyofAfricanAccess.jpg)

----

## Approach
- Gain spatial understanding of change in energy access rates and deforestation rates in Ghana from 2003-2014 (maps)
- Assess the degree to which energy access rates impact deforestation rates (regression, BiLISA)
- Produce graphs and maps to provide visual evidence of findings (mapview)

----

## Methods - Survey Data to Vector

1. Download Demographic and Health Survey (DHS) data from IPUMS for 2003, 2008, 2014
      - Variables: Electricity (0-No, 1-Yes), Cooking Fuel (aggregate all wood-based fuels to 1, rest to 0)
      - IPUMS provides census and survey data from around the world integrated across time and space
      - lacking geovariables, so retrieved survey cluster GPS coordinates from DHS stat compiler for the three surveys
2. Clean data to boolean values
3. Aggregate by averaging to cluster points

<center>
| Year | Respondents| Clusters | Districts |
|------:|:-----:|:---------:|:---------:|
| 2003  | 5691  |  412   | 139 |
| 2008  | 4961 |   411   |  139 |
| 2014 |  9396 |  427   |  139 |
</center>

4. Interpolate and aggregate average of pixel values to Ghana districts
5. Review summary statistics
6. Visualize change in variables over time
7. Assess relationship through regression
  
----

## Methods- Raster Data to Vector

1. Import Hansen forest loss data from Google Earth Engine (GEE)
![African Energy Access Chart](../Vignettes/fig/GEE.jpg){ width=75% }

2. Reclassify pixels into time intervals corresponding to DHS survey
3. Extract values to Ghana districts
4. Review summary statistics
5. Visualize change in deforestation overtime
6. Assess relationship to Wood Use as Cooking Fuel and Energy Access

## Results so far

```{r, eval=TRUE, warning=FALSE, message=FALSE, echo=FALSE}
library(sp)
library(rgdal)
library(rgeos)
library(raster)
library(devtools)
library(roxygen2)
library(gstat)
library(dismo)
library(RColorBrewer)
library(viridis)
library(ggplot2)
library(grid)
library(EnergyAccess)

#Read in IPUMS Data
fnm <- system.file("extdata/idhs_00003.csv", package = "EnergyAccess")
IPUMS<- read.csv(file=fnm, stringsAsFactors = FALSE)

#Reassign into boolean values
#IPUMS<-subset(IPUMS, URBAN!=1) #activate for rural only analysis
IPUMS$ELECTRCHH[which(IPUMS$ELECTRCHH ==6 | IPUMS$ELECTRCHH ==8)]<-0
IPUMS$COOKFUEL[which(IPUMS$COOKFUEL==400 | IPUMS$COOKFUEL==500 | IPUMS$COOKFUEL==520 |IPUMS$COOKFUEL==530) ] <-1
IPUMS$COOKFUEL[which(IPUMS$COOKFUEL !=1 )]<-0

#Create seperate tables for 3 time intervals
C_erase<-c("SAMPLE","URBAN","CLUSTERNO", "ELECTRCHH", "COOKFUEL")
data2003<- IPUMS[IPUMS$SAMPLE==2884, names(IPUMS) %in% C_erase]
data2008<- IPUMS[IPUMS$SAMPLE==2885, names(IPUMS) %in% C_erase]
data2014<- IPUMS[IPUMS$SAMPLE==2886, names(IPUMS) %in% C_erase]

#Aggregate to Cluster number by averaging values
d2003<-aggregate(data2003[, 4:5], list(data2003$CLUSTERNO), mean)
d2008<-aggregate(data2008[, 4:5], list(data2008$CLUSTERNO), mean)
d2014<-aggregate(data2014[, 4:5], list(data2014$CLUSTERNO), mean)
d2003$COOKFUEL<-round(d2003$COOKFUEL, 3)*100
d2003$ELECTRCHH<-round(d2003$ELECTRCHH, 3)*100
d2008$COOKFUEL<-round(d2008$COOKFUEL, 3)*100
d2008$ELECTRCHH<-round(d2008$ELECTRCHH, 3)*100
d2014$COOKFUEL<-round(d2014$COOKFUEL, 3)*100
d2014$ELECTRCHH<-round(d2014$ELECTRCHH, 3)*100

#Descriptive stats

qplot(d2003$ELECTRCHH,
      geom="histogram",
      xlab = "Access",
      binwidth= 15,
      fill=I("blue"),
      col=I("red"),
      main = "Ghana Energy Access 2003")
qplot(d2008$ELECTRCHH,
      geom="histogram",
      xlab = "Access",
      binwidth= 15,
      fill=I("blue"),
      col=I("red"),
      main = "Ghana Energy Access 2008")
qplot(d2014$ELECTRCHH,
      geom="histogram",
      xlab = "Access",
      binwidth= 15,
      fill=I("blue"),
      col=I("red"),
      main = "Ghana Energy Access 2014")
qplot(d2003$COOKFUEL,
      geom="histogram",
      xlab = "Wood Use",
      binwidth= 15,
      fill=I("blue"),
      col=I("red"),
      main = "Ghana Wood as Cooking Fuel 2003")
qplot(d2008$COOKFUEL,
      geom="histogram",
      xlab = "Wood Use",
      binwidth= 15,
      fill=I("blue"),
      col=I("red"),
      main = "Ghana Wood as Cooking Fuel 2008")
qplot(d2014$COOKFUEL,
      geom="histogram",
      xlab = "Wood Use",
      binwidth= 15,
      fill=I("blue"),
      col=I("red"),
      main = "Ghana Wood as Cooking Fuel 2014")

### MAKING SURVEY DATA SPATIAL ###
install_github("agroimpacts/EnergyAccess", build_vignettes = TRUE,
               auth_token = "0969e171e5c360c0f37ca7e00e028c07d78cc9a5")
#Import survey cluster points
fnm1 <- system.file("/extdata/c2003c.shp", package= "EnergyAccess")
#fnm2 <- system.file("extdata/clusters2008/c2008c.shp", package = "EnergyAccess")
#fnm3 <- system.file("extdata/clusters2014/c2014c.shp", package = "EnergyAccess")
clust03<-readOGR(fnm1, layer="c2003c") #2003 Survey
#clust08<-readOGR(fnm2) #2008 Survey
#clust14<-readOGR(fnm3) #2014 Survey
```
#attach survey data averages to cluster points
clust03M <- merge(clust03, d2003, by.x = "DHSCLUST",
                  by.y = "Group.1")
clust08M <- merge(clust08, d2008, by.x = "DHSCLUST",
                 by.y = "Group.1")
clust14M <- merge(clust14, d2014, by.x = "DHSCLUST",
                 by.y = "Group.1")
cnames<-c("ELECTRCHH","COOKFUEL")
clust03M<- clust03M[,(names(clust03M) %in% cnames)]
clust08M<- clust08M[,(names(clust08M) %in% cnames)]
clust14M<- clust14M[,(names(clust14M) %in% cnames)]
clust03M <- clust03M[!is.na(clust03M@data$COOKFUEL),]
clust08M <- clust08M[!is.na(clust08M@data$COOKFUEL),]
clust14M <- clust14M[!is.na(clust14M@data$COOKFUEL),]

#Import shapefile of Ghana districts
districts<-shapefile("inst/extdata/DistrictBoundary/GHA_admbndp2_1m_GAUL.shp")
districts <- districts[,(names(districts) %in% "HRname")] #keep column with district names

#project files to Albers Equal Area
dist_albs<-spTransform(x=districts, CRS="+proj=aea +lat_1=20 +lat_2=-23 +lat_0=0
                       +lon_0=25 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs")
c2003<-spTransform(x=clust03M, CRSobj=proj4string(dist_albs))
c2008<-spTransform(x=clust08M, CRSobj=proj4string(dist_albs))
c2014<-spTransform(x=clust14M, CRSobj=proj4string(dist_albs))
clist<-c(c2003, c2008, c2014)

#Inverse Distance Weighing Interpolation of points
r <- raster(extent(dist_albs), res = 2000, crs = crs(dist_albs),
            vals = 1)

interpolCOOK <- lapply(clist, function(x) {
  a <- gstat(id = "COOKFUEL", formula = COOKFUEL ~ 1, data = x)
  b <- interpolate(object = r, model = a)
  c <- mask(x = b, mask = dist_albs)
})
interpolEnergy <- lapply(clist, function(x) {
  a <- gstat(id = "ELECTRCHH", formula = ELECTRCHH ~ 1, data = x)
  b <- interpolate(object = r, model = a)
  c <- mask(x = b, mask = dist_albs)
})

dist_a<-dist_albs
v.vals <- extract(interpolCOOK[[3]], dist_a)
dist_a$COOKFUEL14 <- sapply(v.vals, mean)
v.vals <- extract(interpolCOOK[[2]], dist_a)
dist_a$COOKFUEL08 <- sapply(v.vals, mean)
v.vals <- extract(interpolCOOK[[1]], dist_a)
dist_a$COOKFUEL03 <- sapply(v.vals, mean)

v.vals <- extract(interpolEnergy[[3]], dist_a)
dist_a$ELECTRCHH14 <- sapply(v.vals, mean)
v.vals <- extract(interpolEnergy[[2]], dist_a)
dist_a$ELECTRCHH08 <- sapply(v.vals, mean)
v.vals <- extract(interpolEnergy[[1]], dist_a)
dist_a$ELECTRCHH03 <- sapply(v.vals, mean)

attach(dist_a@data)
relatedd <- subset(dist_a@data, select = c("deforest03", "ELECTRCHH03"))
cor(relatedd)
detach(dist_a@data)
### VISUALIZATION ###
#data displayed in voronoi polygons
allyrs<-c(c2003, c2008, c2014)
ghana <- aggregate(dist_albs)
v_allyrs<-lapply (allyrs, function(x) {
  v<- voronoi(x)
  intersect(v, ghana)
})
#interactive maps of voronoi polygons
library(mapview)
cols<-rev(get_col_regions())
vc_map03<-mapview(v_allyrs[[1]], zcol="COOKFUEL", popup=NA, layer.name="2003 Wood Use", alpha.regions=100, col="gray27", legend=TRUE, col.regions=cols)
vc_map08<-mapview(v_allyrs[[2]], zcol="COOKFUEL", popup=NA, layer.name="2008 Wood Use", alpha.regions=100, col="gray27", legend=TRUE, col.regions=cols)
vc_map14<-mapview(v_allyrs[[3]], zcol="COOKFUEL", popup=NA, layer.name="2014 Wood Use", alpha.regions=100, col= "gray27", legend=TRUE, col.regions=cols)
CookvMaps=vc_map03+vc_map08+vc_map14
CookvMaps
ve_map03<-mapview(v_allyrs[[1]], zcol="ELECTRCHH", popup=NA, layer.name="2003 Energy Access", alpha.regions=100, col= "gray27", legend=TRUE, col.regions=cols)
ve_map08<-mapview(v_allyrs[[2]], zcol="ELECTRCHH", popup=NA, layer.name="2008 Energy Access", alpha.regions=100, col= "gray27", legend=TRUE, col.regions=cols)
ve_map14<-mapview(v_allyrs[[3]], zcol="ELECTRCHH", popup=NA, layer.name="2014 Energy Access", alpha.regions=100, col= "gray27", legend=TRUE, col.regions=cols)
ElecvMaps=ve_map03+ve_map08+ve_map14
ElecvMaps
webshot::install_phantomjs()
mapshot(CookvMaps, file = "my_interactive_map.html") #create html
?mapview

#extract values from voronoi to districts so there arent too many 1's and 0's
v_district<-lapply(v_allyrs, function(x) {
  over(x=dist_albs, y=x[1:2], fn=mean)
})
v_allyrs[1]
d03<-as.data.frame(v_district[1])
d08<-as.data.frame(v_district[2])
d14<-as.data.frame(v_district[3])
dist_albs$COOKFUEL03<-round(d03[,"COOKFUEL"],3)
dist_albs$ELECTRCHH03<-round(d03[,"ELECTRCHH"],3)
dist_albs$COOKFUEL08<-round(d08[,"COOKFUEL"],3)
dist_albs$ELECTRCHH08<-round(d08[,"ELECTRCHH"],3)
dist_albs$COOKFUEL14<-round(d14[,"COOKFUEL"],3)
dist_albs$ELECTRCHH14<-round(d14[,"ELECTRCHH"],3)

#interactive maps of districts
e_map03<-mapview(dist_albs, zcol="ELECTRCHH03", layer.name="2003 Energy Access", maxpoints=40000000, alpha.regions=100,legend=TRUE)
e_map08<-mapview(dist_albs, zcol="ELECTRCHH08", layer.name="2008 Energy Access", maxpoints=40000000, alpha.regions=100,legend=TRUE)
e_map14<-mapview(dist_albs, zcol="ELECTRCHH14", layer.name="2014 Energy Access", maxpoints=40000000, alpha.regions=100,legend=TRUE)
ElecMaps=e_map03+ e_map08 +e_map14
ElecMaps
c_map03<-mapview(dist_albs, zcol="COOKFUEL03", layer.name="2003 Wood Use", maxpoints=40000000, alpha.regions=100,legend=TRUE)
c_map08<-mapview(dist_albs, zcol="COOKFUEL08", layer.name="2008 Wood Use", maxpoints=40000000, alpha.regions=100,legend=TRUE)
c_map14<-mapview(dist_albs, zcol="COOKFUEL14", layer.name="2014 Wood Use", maxpoints=40000000, alpha.regions=100,legend=TRUE)
CookMaps<-c_map03+c_map08+c_map14
CookMaps

```

## Next Steps, suggestions







## 

<br></br>

<font size="18"><center>

Questions? Suggestions
</font></center>



